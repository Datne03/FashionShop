<app-navbar></app-navbar>
<div class="container mt-4">
     <div class="row">
          <div class="col-md-3">
               <mat-card class="cardWithShadow">

                    <div class="list-group">
                         <button class="list-group-item list-group-item-action" [class.active]="activeTab === 'info'"
                              (click)="activeTab = 'info'">üë§ T√†i kho·∫£n c·ªßa t√¥i</button>
                         <button class="list-group-item list-group-item-action" [class.active]="activeTab === 'orders'"
                              (click)="activeTab = 'orders'">üì¶ ƒê∆°n mua</button>
                         <button class="list-group-item list-group-item-action"
                              [class.active]="activeTab === 'vouchers'" (click)="activeTab = 'vouchers'">üéÅ Kho
                              voucher</button>
                    </div>
               </mat-card>
          </div>

          <div class="col-md-8">
               <mat-card class="cardWithShadow">
                    <div *ngIf="activeTab === 'info'" style="margin: 15px;">
                         <h4>üë§ T√†i kho·∫£n c·ªßa t√¥i</h4>
                         <ul class="nav nav-tabs mb-3">
                              <li class="nav-item">
                                   <a class="nav-link" [class.active]="infoSubTab === 'profile'"
                                        (click)="infoSubTab = 'profile'">üìÑ H·ªì s∆°</a>
                              </li>
                              <li class="nav-item">
                                   <a class="nav-link" [class.active]="infoSubTab === 'address'"
                                        (click)="infoSubTab = 'address'">üè† ƒê·ªãa ch·ªâ</a>
                              </li>
                         </ul>
                         <div *ngIf="infoSubTab === 'profile'">
                              <div class="text-center my-4">
                                   <img [src]="avatarPreview || ('http://localhost:8080/images/avatar/' + user.avatar + '?default')"
                                        alt="·∫¢nh ƒë·∫°i di·ªán" class="img-fluid rounded-circle"
                                        style="width: 150px; height: 150px; object-fit: cover;">
                              </div>
                              <div class="text-center">
                                   <label for="avatarUpload" class="btn btn-primary"
                                        style="height: 30px; width: 100px; font-size: 12px">
                                        üì∑ Ch·ªçn ·∫£nh
                                   </label>
                                   <input type="file" id="avatarUpload" hidden (change)="onUploadAvatar($event)"
                                        accept="image/*">
                              </div>
                              <div class="text-center mt-2">
                                   <button class="btn btn-success me-2"
                                        style="height: 30px; width: 70px; font-size: 12px" (click)="onSaveAvatar()"
                                        [disabled]="!avatarFile">üíæ
                                        L∆∞u</button>
                                   <button class="btn btn-secondary" style="height: 30px; width: 70px; font-size: 12px"
                                        (click)="onCancelAvatar()" [disabled]="!avatarFile">‚ùå
                                        Hu·ª∑</button>
                              </div>

                              <div *ngIf="!editMode">
                                   <p><strong>H·ªç t√™n:</strong> {{ user.username }}</p>
                                   <p><strong>Email:</strong> {{ user.email }}</p>
                                   <p><strong>SƒêT:</strong> {{ user.phone }}</p>
                                   <button class="btn btn-outline-primary" (click)="editMode = true">Ch·ªânh s·ª≠a h·ªì
                                        s∆°</button>
                              </div>

                              <form *ngIf="editMode" (ngSubmit)="updateProfile()" #profileForm="ngForm">
                                   <div class="mb-3">
                                        <label><strong>H·ªç t√™n:</strong></label>
                                        <input type="text" class="form-control" [value]="user.username" readonly>
                                   </div>

                                   <div class="mb-3">
                                        <label><strong>Email:</strong></label>
                                        <input type="email" class="form-control" [(ngModel)]="user.email" name="email"
                                             required>
                                   </div>

                                   <div class="mb-3">
                                        <label><strong>SƒêT:</strong></label>
                                        <input type="text" class="form-control" [(ngModel)]="user.phone" name="phone"
                                             required>
                                   </div>

                                   <button type="submit" class="btn btn-primary me-2"
                                        [disabled]="!profileForm.valid">L∆∞u</button>
                                   <button type="button" class="btn btn-secondary" (click)="cancelEdit()">H·ªßy</button>
                              </form>
                              <div class="mt-4">
                                   <h5>üîí ƒê·ªïi m·∫≠t kh·∫©u</h5>
                                   <input type="password" [(ngModel)]="oldPassword" placeholder="M·∫≠t kh·∫©u hi·ªán t·∫°i"
                                        class="form-control mb-2" />
                                   <input type="password" [(ngModel)]="newPassword" placeholder="M·∫≠t kh·∫©u m·ªõi"
                                        class="form-control mb-2" />
                                   <input type="password" [(ngModel)]="confirmNewPwd"
                                        placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi" class="form-control mb-2" />
                                   <button class="btn btn-warning"
                                        (click)="onChangePassword(oldPassword, newPassword, confirmNewPwd)">ƒê·ªïi m·∫≠t
                                        kh·∫©u</button>
                              </div>
                         </div>
                         <div *ngIf="infoSubTab === 'address'">
                              <p><strong>ƒê·ªãa ch·ªâ hi·ªán t·∫°i:</strong></p>
                              <ul class="list-group">
                                   <li *ngFor="let addr of address"
                                        class="list-group-item d-flex justify-content-between align-items-center">
                                        <span>{{ addr.address }}</span>
                                        <div>
                                             <button class="btn btn-sm btn-outline-secondary me-2"
                                                  (click)="editAddress(addr)">S·ª≠a</button>
                                             <button class="btn btn-sm btn-outline-danger"
                                                  (click)="deleteAddress(addr.id)">Xo√°</button>
                                        </div>
                                   </li>
                              </ul>

                              <button class="btn btn-outline-success mt-3" (click)="showAddAddress = true">‚ûï Th√™m ƒë·ªãa
                                   ch·ªâ m·ªõi</button>
                              <div *ngIf="showAddAddress || selectedAddress" class="mt-3">
                                   <h5>{{ selectedAddress ? 'üõ†Ô∏è S·ª≠a ƒë·ªãa ch·ªâ' : '‚ûï Th√™m ƒë·ªãa ch·ªâ m·ªõi' }}</h5>
                                   <form (ngSubmit)="saveAddress()" #addressForm="ngForm">
                                        <div class="mb-2">
                                             <label>T·ªânh/Th√†nh ph·ªë:</label>
                                             <select class="form-control" [(ngModel)]="addressFormData.province"
                                                  name="province" (change)="onProvinceChange()" required>
                                                  <option *ngFor="let p of provinces" [ngValue]="p.ProvinceName">{{
                                                       p.ProvinceName }}</option>
                                             </select>
                                        </div>

                                        <div class="mb-2">
                                             <label>Qu·∫≠n/Huy·ªán:</label>
                                             <select class="form-control" [(ngModel)]="addressFormData.district"
                                                  name="district" (change)="onDistrictChange()" required>
                                                  <option *ngFor="let d of districts" [ngValue]="d.DistrictName">{{
                                                       d.DistrictName }}</option>
                                             </select>
                                        </div>

                                        <div class="mb-2">
                                             <label>Ph∆∞·ªùng/X√£:</label>
                                             <select class="form-control" [(ngModel)]="addressFormData.ward" name="ward"
                                                  required>
                                                  <option *ngFor="let w of wards" [ngValue]="w.WardName">{{ w.WardName
                                                       }}</option>
                                             </select>
                                        </div>

                                        <div class="mb-2">
                                             <label>ƒê·ªãa ch·ªâ c·ª• th·ªÉ (s·ªë nh√†, ƒë∆∞·ªùng):</label>
                                             <input type="text" class="form-control"
                                                  [(ngModel)]="addressFormData.street" name="street" required />
                                        </div>

                                        <button type="submit" class="btn btn-primary me-2"
                                             [disabled]="!addressForm.valid">L∆∞u</button>
                                        <button type="button" class="btn btn-secondary"
                                             (click)="cancelAddressForm()">H·ªßy</button>
                                   </form>

                              </div>
                         </div>

                    </div>

                    <div *ngIf="activeTab === 'orders'" style="margin: 15px;">
                         <h4>üì¶ ƒê∆°n mua</h4>

                         <ul class="nav nav-tabs mb-3">
                              <li class="nav-item">
                                   <a class="nav-link" [class.active]="infoSubTab === 'orders'"
                                        (click)="infoSubTab = 'orders'">üì¶ ƒê∆°n h√†ng</a>
                              </li>
                              <li class="nav-item">
                                   <a class="nav-link" [class.active]="infoSubTab === 'support'"
                                        (click)="infoSubTab = 'support'">üìÑ ƒê∆°n h√†ng b√°o c√°o</a>
                              </li>
                         </ul>

                         <div *ngIf="infoSubTab === 'orders'">
                              <div *ngFor="let order of orders | paginate: { itemsPerPage: 5, currentPage: page }"
                                   class="card mb-3 shadow-sm">
                                   <div class="card-body">
                                        <!-- <h5 class="card-title">
                                             M√£ ƒë∆°n: {{ order.orderItems[0]?.productVariant?.product?.name || 'Kh√¥ng x√°c
                                             ƒë·ªãnh' }}
                                        </h5> -->
                                        <p class="card-text">
                                             Ng√†y ƒë·∫∑t: {{ order.createdAt | date:'dd/MM/yyyy HH:mm' }} <br>
                                             T·ªïng ti·ªÅn: {{ order.totalPrice | currency:'VND' }} <br>
                                             Tr·∫°ng th√°i: {{
                                             order.status === 'PENDING' ? 'Ch·ªù x·ª≠ l√Ω' :
                                             order.status === 'SHIPPED' ? 'ƒêang giao h√†ng' :
                                             order.status === 'CONFIRMED' ? 'ƒêang x·ª≠ l√Ω' :
                                             order.status === 'DELIVERED' ? 'Ho√†n th√†nh' :
                                             order.status === 'CANCELED' ? 'ƒê√£ h·ªßy' :
                                             'Kh√¥ng x√°c ƒë·ªãnh'
                                             }}
                                        </p>
                                        <button class="btn btn-outline-primary"
                                             (click)="goToOrderDetail(order.id)">Xem</button>
                                   </div>
                              </div>
                              <div class="pagination-container">
                                   <pagination-controls (pageChange)="page = $event"></pagination-controls>
                              </div>
                         </div>

                         <div *ngIf="infoSubTab === 'support'">

                              <div *ngFor="let sp of support | paginate: { itemsPerPage: 5, currentPage: page }"
                                   class="card mb-3 shadow-sm">
                                   <div class="card-body">
                                        <h5 class="card-title">
                                             M√£ b√°o c√°o: {{ sp.id || 'Kh√¥ng x√°c
                                             ƒë·ªãnh' }}
                                        </h5>
                                        <p class="card-text">
                                             Ng√†y ƒë·∫∑t: {{ sp.createdAt | date:'dd/MM/yyyy HH:mm' }} <br>
                                             ƒê∆°n h√†ng: {{ sp.order.id }} <br>
                                             V·∫•n ƒë·ªÅ: {{ sp.issue }} <br>
                                             Tr·∫°ng th√°i: {{
                                             sp.status === 'PENDING' ? 'Ch·ªù x·ª≠ l√Ω' :
                                             sp.status === 'REPLIED' ? 'ƒê√£ ph·∫£n h·ªìi' :
                                             'Kh√¥ng x√°c ƒë·ªãnh'
                                             }} <br>
                                             Ng√†y ph·∫£n h·ªìi: {{ sp.repliedAt | date:'dd/MM/yyyy HH:mm' }} <br>
                                             Ph·∫£n h·ªìi: {{ sp.adminReply }}
                                        </p>
                                   </div>
                              </div>
                              <div class="pagination-container">
                                   <pagination-controls (pageChange)="page = $event"></pagination-controls>
                              </div>
                         </div>

                    </div>

                    <div *ngIf="activeTab === 'vouchers'" style="margin: 15px;">
                         <h4>üéÅ Kho Voucher</h4>
                         <ul class="list-group">
                              <li *ngFor="let voucher of vouchers" class="list-group-item">
                                   <strong>{{ voucher.userVoucher.code }}</strong>: Gi·∫£m {{ voucher.userVoucher.discount
                                   }}%
                                   <span class="text-muted"> (HSD: {{ voucher.userVoucher.endDate }})</span>
                              </li>
                         </ul>
                    </div>
               </mat-card>
          </div>
     </div>
</div>
<app-footer></app-footer>
<app-chatbot></app-chatbot>